# Compiler toolchain for Cray EX Programming Environment GNU compiler (cpe-gnu)
easyblock = 'CrayPEToolchainRep'

name = 'cpeGNU'
version = "21.04"

homepage = 'https://pubs.cray.com'

whatis = [
    "Desription: EasyBuild toolchain using the Cray compiler wrapper with gcc module (CPE release %(version)s)"
]

description = """
This module is the EasyBuild toolchain that uses the Cray compiler wrapper with
the gcc compiler activated. The components loaded are those of the Cray Programming
Environment (CPE) version %(version)s.

The toolchain works differently from the way the Cray PE usually works. Rather than
loading PrgEnv-gnu and cpe/%(version)s, it loads concrete versions of all modules
instead that would be loaded by these variants. This ensures better reproducibility
as which modules are loaded by PrgEnv-gnu depends on a single configuration file
on the system that may change over time. The net effect of the module is the same
though.

"""

toolchain = SYSTEM

PrgEnv = 'gnu'

cray_targets = [
    'craype-x86-rome',
    'craype-accel-host',
    'craype-network-ofi'
]

dependencies = [
   ('gcc/9.3.0',              EXTERNAL_MODULE),
   ('craype/2.7.6',           EXTERNAL_MODULE),
   ('cray-mpich/8.1.4',       EXTERNAL_MODULE),
   ('cray-libsci/21.04.1.1',  EXTERNAL_MODULE),
   ('cray-dsmml/0.1.4',       EXTERNAL_MODULE),
   ('perftools-base/21.02.0', EXTERNAL_MODULE),
   ('xpmem',                  EXTERNAL_MODULE),
]

moduleclass = 'toolchain'
